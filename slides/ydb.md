# YDB INFO
## In a nutshell

YDB — технология, позволяющая создавать крупные сервисы, которые способны выдерживать большую операционную нагрузку (до уровня миллионов запросов в секунду). 
YDB написан на `C++`. В качестве языка запросов по умолчанию используется YQL (YDB Query Language) — диалект SQL со строгой типизацией. Входит в число СУБД, предоставляющих ACID-гарантии транзакций.
Ближайшие аналоги среди систем баз данных, также доступных в виде открытого ПО, — YugabyteDB и CockroachDB.
YDB подразумевает самостоятельное развёртывание на кластеры физических хостов или виртуальных машин при помощи инструментов 
Kubernetes, либо в качестве управляемого сервиса в Yandex Cloud. Для управляемой реализации выбирается режим бессерверных вычислений или Dedicated-режим.

Источник: [Wiki](https://ru.wikipedia.org/wiki/YDB#%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C). 

## Development history
В 2010 году внутри Яндекса началась разработка собственной NoSQL СУБД KiWi. 
Она начала использоваться в 2011 году. Однако KiWi обеспечивала «согласованность в конечном счёте» и 
обладала другими недостатками модели NoSQL.
В 2012 году началась внутренняя разработка проекта KiKiMR, 
и только для нужд Яндекса. За пределами компании проект назвали YDB.
В 2016 году СУБД стала использоваться в сервисах Яндекса.
В 2018 году состоялся запуск облачной платформы Yandex Cloud,
хранение данных в которой было основано на YDB.
В то же время компания объявила, что в будущем сделает YDB доступной в
Yandex Cloud в качестве управляемого сервиса. Позднее такой доступ 
действительно начал предоставляться наряду с другими управляемыми 
сервисами — для PostgreSQL, MongoDB и других. 
Эта облачная версия получила название Yandex Database (позднее — Managed service for YDB).
В апреле 2022 года СУБД YDB была опубликована на GitHub как свободное программное обеспечение 
под лицензией Apache 2.0. 

Источник: [Wiki](https://ru.wikipedia.org/wiki/YDB#%D0%98%D1%81%D1%82%D0%BE%D1%80%D0%B8%D1%8F). 
## DB interaction tools
Cпособы установки:
- YDB Kubernetes Operator — позволяет развернуть кластер YDB в Kubernetes и управлять им ([Источник](https://ydb.tech/docs/ru/devops/kubernetes/initial-deployment)).
- YDB Docker Image — позволяет развернуть кластер YDB в Docker и управлять им ([Источник](https://ydb.tech/docs/ru/quickstart)).
- Bash script — позволяет развернуть кластер YDB в Linux и управлять им ([Источник](https://ydb.tech/docs/ru/quickstart)).

Согласно представленным источникам, существует несколько инструментов для взаимодействия с YDB:
- YDB SDK — доступны SDK, которые упрощают взаимодействие с YDB из приложений. Поддерживаемые языки программирования: `C++`, `C#`,`Go`,`Java`,`Node.js`,`PHP`,`Python`,`Rust` ([Источник](https://ydb.tech/docs/ru/reference/ydb-sdk/)).
- YDB Web Interface — встроенный веб-интерфейс для управления и мониторинга YDB ([Источник](https://ydb.tech/docs/ru/quickstart)).
- FluentBit — инструмент для сбора логов в Kubernetes кластере с последующим сохранением в YDB ([Источник](https://ydb.tech/docs/ru/integrations/fluent-bit)).
- YDB CLI — встроенный терминальный интерфейс, аналог YDB Web Interface.

## YDB database engine
Подсистема хранения данных в `YDB` — YDB BlobStorage — подсистема YDB, которая отвечает за надежное хранение данных.
Позволяет хранить блобы (бинарный фрагмент размером от 1 байта до 10 мегабайт) c уникальным идентификатором.

YDB поддерживает реляционную модель данных и оперирует таблицами с предопределенной схемой. Для удобства организации таблиц поддерживается создание директорий по аналогии с файловой системой. Помимо таблиц YDB поддерживает топики, которые представляют собой сущность для хранения неструктурированных сообщений и доставки их множеству подписчиков.

Подробнее: [Источник](https://ydb.tech/docs/ru/concepts/cluster/distributed_storage)

## YQL
YQL (YDB Query Language) — универсальный декларативный язык запросов к YDB, диалект SQL. YQL создавался для работы с большими распределенными базами данных, и поэтому обладает рядом отличий от стандарта SQL. Запросы можно писать через `CLI`, `WebInterface`, `SDK`
очень подробная визуализация первых двух способов есть в [README.md](../README.md)

`YQL` строго типизированный язык запросов. Есть поддержка следующих численных типов данных:
`Bool`, `Int*`, `Uint*`, `Float`, `Double`, `Decimal` И `DyNumber`. Заместо знака астерикс можно подставить любое число из множества `{8, 16, 32}`. Последние два типа репрезентируют вещественное число с указанной точностью, до 35 десятичных знаков и бинарное представление
вещественного числа с точностью до 38 знаков соответственно.

Также есть поддержка строковых типов: `String`, `Utf8`, `Json`, `JsonDocument`, `Yson`, `Uuid`; соотвественно есть и форматы даты и 
времени. Переменные всех этих типов данных можно поместить в различные контейнеры такие, как `List`, `Dict` и т.д.

В языке реализованое явное и неявно приведение типов данных.

Помимо привычных типов данных есть и опциональные такие как `NULL` и т.д.

Формальный запрос на языке `YQL` очень схож с запросом на языке `SQL` и представляет собой валидный `UTF-8` текст, который состоит из команд (statement) разделенных символом точка с запятой (;).
Последняя точка с запятой при этом может отсутствовать.
Каждая команда, в свою очередь, состоит из последовательности токенов допустимых для данной команды.
Токеном может быть ключевое слово, идентификатор, литерал и другие.
Токены разделяются пробельными символами (пробел, табуляция, перевод строки) либо комментариями. Комментарий не является частью команды и синтаксически эквивалентен пробельному символу. 


[Источник](https://ydb.tech/docs/ru/yql/reference/)

## Decentralization
Кластер YDB — множество узлов YDB, между которыми распределяется нагрузка, коммуницирующих друг с другом через сеть. На одном кластере может обслуживаться множество баз данных, под каждую БД выделяются определенные узлы кластера. Одна БД целиком располагается на одном кластере.

Одна инсталляция YDB состоит из кластера, который разбит на узлы. Узел — это один процесс в системе, как правило ydbd. Это узел входит в кластер и может обмениваться данными с другими узлами в этом кластере через Interconnect. Каждый узел имеет свой идентификатор, который обычно называется NodeId. NodeId — целое число от 1, состоит из 20 бит. NodeId 0 зарезервирован для внутренних нужд и как правило обозначает текущий узел, либо отсутствие узла.

Кластер YDB может быть однодатацентровым или геораспределенным. Минимальный однадатацентровый кластер состоит из одного узла.
Кластер YDB состоит из статических и динамических узлов:

- Статические узлы обеспечивают хранение данных, реализуя одну из поддерживаемых схем избыточности в зависимости от установленного режима работы;
- Динамические узлы обеспечивают выполнение запросов, координацию транзакций и другие функции управления данными.

На каждом узле выполняются специальные микросервисы, которые называются таблетками. Таблетки и реализуют алгоритм синхронизации, 
который очень схож с `Paxos` или `Raft`:

    Таблетка-лидер записывает данные в распределенное сетевое хранилище, которое сохраняет копии в нескольких дата-центрах. 
    YDB подтверждает пользователю запрос только после успешного сохранения нужного числа копий в нужном числе дата-центров.

[Источник](https://ydb.tech/docs/ru/concepts/cluster/common_scheme_ydb)
## Indexes
В YDB поддерживаются вторичные индексы. Вторичные индексы в YDB — глобальные и могут быть неуникальными.

В YDB автоматически создается индекс по первичному ключу, поэтому выборки с условием по первичному ключу всегда выполняются эффективно, затрагивая только требуемые строки. Выборка с условием, наложенным на одну или несколько неключевых колонок, как правило, приводит к полному сканированию таблицы. Для того чтобы такие выборки были эффективными, нужно использовать вторичные индексы.

В текущей версии YDB реализованы синхронные и асинхронные глобальные вторичные индексы. Каждый индекс представляет собой скрытую таблицу, которая обновляется:

-  для синхронных индексов — транзакционно при изменении основной таблицы;
-  для асинхронных индексов — в фоне, получая необходимые изменения из основной таблицы.

Когда пользователь присылает SQL-запрос на вставку, изменение или удаление данных, БД прозрачно для пользователя формирует команды на изменение индексной таблицы. У таблицы может быть несколько вторичных индексов. Индекс может включать несколько колонок, при этом важен порядок указания колонок в индексе. Одна колонка может быть включена в нескольких индексов. В дополнение к указанным колонкам в индексе всегда неявно сохраняются значения колонок первичного ключа таблицы, чтобы от найденной записи в индексе можно было перейти к записи в таблице.

Пример создания индексов находится в файле [README.md](../README.md).


[Источник](https://ydb.tech/docs/ru/concepts/secondary_indexes)

